<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./docs.css">
    
    <title>humanID</title>  
  
</head>
<body>
  <div class="navbar-fixed">
    <nav class="nav-wrapper #000000 black">
      <div class="container">
          <a href="#" class="brand-logo" id="logo"><img width="130px" src="https://cdn.glitch.com/e7ec1ecc-8235-4381-8966-9202576ad0f6%2FhumanID%20logo%20blue_horizontal_without%20tagline%20PNG.png?v=1596925016295"></a>
          <a href="#" class="sidenav-trigger" data-target="mobile-links">
              <i class="material-icons">menu</i>
          </a>
          <ul class="right hide-on-med-and-down">
            <li class="myNav"><a href="index.html">Home</a></li>
            <li class="myNav"><a href="docs.html">Docs</a></li>
            <li class="myNav"><a href="integration.html">Integration</a></li> 
            <li class="myNav"><a href="blog.html">Blog</a></li> 
            <li class="myNav"><a href="faq.html">FAQ</a></li> 
          </ul>
      </div>
  </nav>
</div>
  <ul class="sidenav" id="mobile-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="docs.html">Docs</a></li>
    <li><a href="integration.html">Integration</a></li> 
    <li><a href="blog.html">Blog</a></li> 
    <li><a href="faq.html">FAQ</a></li> 
  </ul>

 
  <div class="container"> 
    <div class="row">
      <nav id="sidebar" class="col-md-2 d-block bg-light sidebar">
        <div class="sidebar-sticky">
          <div class="sidebar-content">
            <form class="form">
              <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
            </form>
  
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <span data-feather="home"></span>
                  humanID Core API <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#first_section">
                  <span data-feather="file"></span>
                  Prerequisites
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#second_section"> 
                  <span data-feather="shopping-cart"></span>
                  Setup
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#third_section">
                  <span data-feather="users"></span>
                  Configuration
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#fourth_section">
                  <span data-feather="bar-chart-2"></span>
                  Class/Entity Relationship Diagram
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#fifth_section">
                  <span data-feather="layers"></span>
                  Web Login Examples
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#sixth_section">
                  <span data-feather="layers"></span>
                  Mobile API Recipes
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#seventh_section">
                  <span data-feather="layers"></span>
                  License
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
  
      <main id="main" class="col-md-10">

        <div>
          <h6 id="title">humanID Core API</h6>
          humanID API server. API doc and demo <a target="_blank" href="https://humanid.herokuapp.com">https://humanid.herokuapp.com</a><br/>

          Details about humanID Web SDK can be found <a target="_blank" href="https://github.com/bluenumberfoundation/humanid-api/blob/master/client/README.md">here</a><br/>
          
          Demo data:<br/><br/>
          
          Admin</br>
          <code><pre>
{
  "email": "admin@local.host",
  "password": "admin123"
}</pre>
          </code>
          Apps<br/>
          <code><pre>
[{
    "id": "DEMO_APP",
    "secret": "2ee4300fd136ed6796a6a507de7c1f49aecd4a11663352fe54e54403c32bd6a0",
    "platform": "ANDROID",
  "serverKey": "AAAA....S4"    
},
{
    "id": "DEMO_APP_IOS",
    "secret": "541ec90bf636f0a8847885af37faedc258dcc875481f870d507c64d0e785bc1e",
    "platform": "IOS",
  "serverKey": null
}]           
</pre>
          </code>
          Users<br/>
      <code>
<pre>
{
  "countryCode": "62",
  "phone": "81234567890",
  "hash": [
      "7a009b9c3203ac3ff081146137e658583d2d60cf867acdb49716b84f1603f8a4", // For DEMO_APP
      "0c88468123e1c193a5f2e925d360266025f739f30ed0eeab7321887905f8c68c", // For DEMO_APP_IOS
    ]
}
</pre>
      </code>
        </div>
        <hr>
        <section class="main-section" id="first_section">
        <header>Prerequisites</header>
            <li>Node.js >= 12 LTS</li>
            <li>RDBMS (MySQL >= 14.14 or SQLite3 >= 3.22)</li>
        </section>

        <hr>
        <section class="main-section" id="second_section">
        <header>Setup</header>
        <li>Install <code>nodejs >= 10.x.x</code></li>
        <li>Clone repo & install dependencies <code>npm i</code></li>
        <li>Run test <code>npm test</code></li>
        <li>Generate database (drop & create) by running on Linux/MacOS<code>npm run db:refresh</code></li>
        <li>Generate doc (requires apidoc <a target="_blank" href="http://apidocjs.com">http://apidocjs.com</a>)<code>npm run doc</code></li>
        <li>Build client SDK (javascript) <code>npm run build</code></li>
To generate database on Windows maybe you can run <code>setx NODE_ENV=DATABASE && npx sequelize db:drop && sequelize db:create && npx sequelize db:migrate && npx sequelize db:seed:all</code> (UNTESTED)
        </section>
        <hr>
              <section class="main-section" id="third_section">
        <header>Configuration</header>
        App configuration is read from config.json. You can reuse the provided example in config.json.example<br/><br/>
          <b>Database</b><br/>
          For DATABASE configuration, please refer to <a target="_blank" href="https://sequelize.org/master/manual/getting-started">Sequelize configuration</a>. Some common examples:<br/><br/>

          <p class="text-muted">Sqlite3 file storage</p>
          <code>
            <pre>
{
"DATABASE": {
  "username": "root",
  "password": null,
  "database": "humanid",
  "dialect": "sqlite",
  "storage": "db.sqlite"
  },
}</pre>
          </code>

          <p class="text-muted">MySQL with connection pooling</p>
          <code>
            <pre>
{
  "DATABASE": {
    "username": "root",
    "password": "root",
    "database": "humanid",
    "dialect": "mysql",
    "pool": {
       "max": 5,
       "min": 0,
       "acquire": 30000,
       "idle": 10000
        }    
  },
}</pre>
          </code>

          <b>SMS OTP/Verification</b><br/>
          To enable phone number verification SMS using <a target="_blank" href="https://www.vonage.com/communications-apis/sms/">Nexmo</a> please provide valid configuration like below (replace values with your own account details):

          <code>
<pre>
{
  "NEXMO_REST_URL": "https://rest.nexmo.com",
  "NEXMO_API_KEY": "abcd1234",
  "NEXMO_API_SECRET": "abcdefgh12345678",
}</pre>
          </code>

          <p class="text-muted"> If one or more value are missing, no verification SMS will be triggered and verification code is not validated (always considered valid)</p>
          
          <b>Push Notification</b><br/>
          To enable push notification using <a target="_blank" href="https://firebase.google.com/docs/admin/setup?authuser=0#initialize_the_sdk">Firebase Cloud Messaging</a>, provide valid like below (replace values with your own account details):
        
        <code>
<pre>
{
  "FIREBASE_SERVER_KEY": "AAAAVo...BmFpE",
}</pre>
        </code>

        <p class="text-muted">Currently this is only used for IOS. For Android, serverKey for each apps are used</p>

        </section>
        <hr>
              <section class="main-section" id="fourth_section">
        <header>Class/Entity Relationship Diagram</header>
        The API server stores data in given structure:
        <p class="text-muted">SequelizeMeta is just ORM migration metadata which is not related to business process</p>
        <img width="100%" src="https://cdn.glitch.com/c0dcb651-5b19-4756-a6e6-25b3982ca367%2Ferd.png?v=1597163286762" alt="ERD Diagram"/>
        </section>

        <hr>
              <section class="main-section" id="fifth_section">
        <header>Web Login Examples</header>
        Web login implementation example can be found in 
        <code>http://localhost:3000/examples/login.html</code>
        
       
        To simulate web login with push notification, follow these steps:
       <ol> 
       <li>Make sure Push Notification configuration above has been done</li>
       <li>Open in a tab http://localhost:3000/examples/confirm.html and allow notification. Leave it open</li>
       <li>Open in another tab http://localhost:3000/examples/login.html enter country code & phone number (demo data provided above) and click Login by App</li>
       <li>Go to previous tab that points to http://localhost:3000/examples/confirm.html. A confirmation dialog should be shown. Click Confirm</li>
       <li>Return to tab http://localhost:3000/examples/login.html. In less than 5 seconds, you should be redirected to http://localhost:3000/examples/secured.html</li>
      </ol>

      <p class="text-muted">In the actual implementation, every actions in confirm.html can only be done from mobile device. Because it requires login hash which should be kept secret per user/app.</p>
        
      To simulate web login with OTP SMS, follow these steps:
      <ol>
        <li>Make sure SMS OTP/Verification above has been done, and you have register a valid phone number using POST /mobile/users/register</li>
        <li>Open http://localhost:3000/examples/login.html enter country code & phone number (demo data provided above) and click Login by SMS</li>
        <li>Wait for SMS containing OTP, enter it to the form, then click Verify & Login</li>
        <li>You should be redirected to http://localhost:3000/examples/secured.html</li>
      </ol>
    
    </section>

        <hr>
        <section class="main-section" id="sixth_section">
  <header>Mobile API Recipes</header>
  <b>Registration</b><br/>
  Fresh login (no other partner app logged-in yet):
  <ol>
  <li>POST /mobile/users/verifyPhone Verify user phone number (request OTP SMS)</li>
  <li>POST /mobile/users/register Register user. Get the hash from response and store safely in device</li>
  </ol>

  <b>Login</b><br/>
  Login when there is another existing partner app logged-in:
  <ol>
  <li>POST /mobile/users/login Login using existing partner app hash. Get the hash for the new app and store it safely</li>
  </ol>

  <b>Validation</b><br/>
  Check if a hash is still valid:
  <ol>
  <li>GET /mobile/users/login Get login status</li>
  </ol>

  <b>Switch Device</b><br/>
  Login from a new device (previously logged-in from different device):
  <p class="text-muted">The same as new registration. Everything else is handled in server/backend</p>  
  <ol>
  <li>POST /mobile/users/verifyPhone Verify user phone number (request OTP SMS)</li>
  <li>POST /mobile/users/register Register user. Get the hash from response and store safely in device</li>
  </ol>


  <b>Update phone</b><br/>
  Update phone number from an logged-in app:
  <p class="text-muted">The same as new registration. Everything else is handled in server/backend</p>  
  <ol>
  <li>POST /mobile/users/verifyPhone Verify user new phone number (request OTP SMS)</li>
  <li>POST /mobile/users/updatePhone Update phone</li>
  </ol>


  <b>Web login confirmation</b><br/>
  Confirm login request from web client:
  <ol>
  <li>PUT /mobile/users Update notification ID (get it from Firebase Cloud Messaging SDK)</li>
  <li>POST /web/users/confirm Confirm (after receiving push notification)</li>
  <li>POST /web/users/reject Or reject</li>
  </ol>
  Push notification payload that need to be handled:<br/>

  <code>
<pre>
{
  "type": "WEB_LOGIN_REQUEST", 
  "requestingAppId": "APP_ID"
}</pre>
  </code>


  </section>

  <hr>
  <section class="main-section" id="seventh_section">
<header>License</header>
Copyright 2019-2020 Bluenumber Foundation
Licensed under the GNU General Public License v3.0 <a target="_blank" href="https://github.com/bluenumberfoundation/humanid-ios-sdk/blob/master/LICENSE">(LICENSE)</a>

</section>     
      </main>
    </div>

  </div>

     
   





<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>

  $(document).ready(function(){
      $('.sidenav').sidenav();
  });

</script>

</body>
</html>